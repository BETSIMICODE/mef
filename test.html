<!DOCTYPE html>
<html lang="mg" data-lang="mg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MEF Madagascar ¬∑ DGI / CF3 ‚Äì Portail d‚Äôinformation</title>
  <meta name="description" content="Portail d‚Äôinformation moderne pour le Minist√®re de l‚Äô√âconomie et des Finances (MEF) ‚Äì Direction G√©n√©rale des Imp√¥ts (DGI) ‚Äì Centre Fiscal CF3 : d√©marches, pi√®ces √† fournir, divisions et contacts." />
  <meta name="theme-color" content="#0b8e78" />
  <style>
    /* ---------- Design System ---------- */
    :root{
      --brand:#0b8e78; --brand-2:#0aa57a; --brand-ink:#0b3f39;      
      --gold:#c8a24a; --bg:#0f172a; --panel:#0b1220; --muted:#94a3b8; --text:#e6eef7;
      --ok:#16a34a; --warn:#f59e0b; --danger:#ef4444;
      --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{margin:0;font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:
      radial-gradient(1000px 1000px at 10% -20%, rgba(10,165,122,.2), transparent),
      radial-gradient(1000px 1000px at 110% 10%, rgba(200,162,74,.15), transparent),
      var(--bg);color:var(--text)}
    a{color:var(--brand-2);text-decoration:none}
    a:hover{text-decoration:none; transform: translateY(-2px)!important; text-shadow: white 0px 0px 1px;}
    .container{width:min(1200px,92vw);margin:0 auto}
    .chip{display:inline-flex;align-items:center;gap:.5rem;border:1px solid #1f2937;border-radius:999px;padding:.25rem .75rem;background:#0a0f1d;color:#cbd5e1}
    .btn{appearance:none;border:0;border-radius:14px;background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#fff;padding:.85rem 1.1rem;font-weight:700;box-shadow:var(--shadow);cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid #1f2937;color:#e2e8f0}
    .btn:active{transform:translateY(1px)}
    .tag{display:inline-block;background:#0b1220;border:1px solid #1e293b;border-radius:10px;padding:.15rem .5rem;color:#93c5fd}
    .grid{display:grid;gap:1.2rem}
    #themeSwitch{
        cursor: pointer!important;
    }
    @media (min-width:720px){.grid.cols-2{grid-template-columns:1fr 1fr}}
    @media (min-width:980px){.grid.cols-3{grid-template-columns:repeat(3,1fr)}.grid.cols-4{grid-template-columns:repeat(4,1fr)}}

    /* ---------- Header / Nav ---------- */
    header{position:sticky;top:0;z-index:50;background:rgba(11,18,32,.7);backdrop-filter:saturate(140%) blur(10px);border-bottom:1px solid rgba(148, 163, 184, 0)}
    nav{display:flex;align-items:center;justify-content:space-between;gap:1rem;padding:.7rem 0}
    .brand{display:flex;align-items:center;gap:.75rem;font-weight:800;letter-spacing:.3px}
    .brand .logo{width:38px;height:38px;border-radius:10px;display:grid;place-items:center;background:conic-gradient(from 220deg,var(--brand),#126f5f,#125348,var(--brand));border:1px solid #0b3f39;box-shadow:inset 0 0 0 2px rgba(255,255,255,.04),var(--shadow)}
    .brand img.logo{height:80px;width:auto;border-radius:8px;background:none;border:0;box-shadow:none}
    .brand strong{font-size:1.1rem}
    .nav-links{display:flex;gap:.9rem;align-items:center}
    .nav-links a{padding:.55rem .7rem;border-radius:10px}
    .nav-links a:hover{background:#0a0f1d; text-decoration: none;}
    #menuBtn{display:none}
    @media (max-width:820px){
      #menuBtn{display:inline-flex; z-index: 200!important;}
      .nav-links{position:fixed;inset:56px 0 auto 0;display:grid;gap:.6rem;padding:1rem;background:rgba(11,18,32,.95);border-bottom:1px solid #111827;transform:translateY(-140%);transition:transform .35s ease}
      .nav-links.open{transform:translateY(0)}
      .nav-links .lang-select{justify-self:end}
      .nav-right{z-index: 200!important;}
    }

    /* ---------- Hero ---------- */
    .hero{position:relative;overflow:hidden}
    .hero .wrap{display:grid;gap:1.4rem;align-items:center;padding:4.5rem 0 3rem}
    .kicker{display:flex;gap:.6rem;flex-wrap:wrap}
    h1{font-size:clamp(28px,5vw,44px);line-height:1.12;margin:0}
    .lead{color:#cbd5e1;max-width:70ch}
    .stats{display:flex;gap:1rem;flex-wrap:wrap;margin-top:.6rem}
    .stat{padding:.6rem .8rem;border-radius:12px;border:1px solid #1e293b00;background:#0b1220}
    .hero-blob{position:absolute;inset:auto -20% -40% auto;width:70vw;max-width:900px;min-height:360px;background:
      radial-gradient(closest-side, rgba(10,165,122,.18), transparent 68%),
      radial-gradient(closest-side, rgba(200,162,74,.14), transparent 60%);filter:blur(40px);transform:rotate(-12deg)}

    /* ---------- Cards ---------- */
    .card{background:linear-gradient(180deg,#0b1220,#0a0f1d);border:1px solid #1f293700;border-radius:var(--radius);box-shadow:var(--shadow);padding:1.1rem}
    .card h3{margin:.2rem 0 .6rem}
    .icon{width:22px;height:22px;display:inline-block}

    /* ---------- Accordion ---------- */
    details{border:1px solid #1f2937;border-radius:14px;background:#0a0f1d;padding:.6rem 1rem}
    details+details{margin-top:.8rem}
    details[open]{background:#0b1220}
    summary{list-style:none;display:flex;align-items:center;gap:.8rem;cursor:pointer}
    summary::-webkit-details-marker{display:none}
    summary .chev{transition:transform .25s ease}
    details[open] summary .chev{transform:rotate(90deg)}
    .epingleContent{
      display: flex;
      align-items: center;
      /* background-color: red; */
      /* width: 100%; */
    }
    .epingle{width:40px;height:40px;vertical-align:middle;margin-right:15px;}



    /* ---------- Sections ---------- */
    section{padding:3rem 0;border-top:1px dashed rgba(148,163,184,.15)}
    section .title{display:flex;align-items:center;justify-content:space-between;gap:1rem;margin-bottom:1.2rem}
    h2{margin:0;font-size:clamp(22px,3.6vw,30px)}
    .title small{color:var(--muted)}

    /* ---------- Footer ---------- */
    footer{padding:2.2rem 0;color:#9aa7bb}

    /* ---------- Motion ---------- */
    .reveal{opacity:0;transform:translateY(16px);transition:opacity .6s ease, transform .6s ease}
    .reveal.show{opacity:1;transform:none}
    @media (prefers-reduced-motion: reduce){*{animation:none !important;transition:none !important}}
    .mef-banner{display:flex;justify-content:center;padding:.25rem 0;background:rgba(11,18,32,.85);border-bottom:1px solid rgba(148,163,184,.08)}
    .mef-banner img{width:min(1200px,96vw);height:auto;display:block}
    @media (max-width:640px){.mef-banner img{max-height:54px;width:auto}}

    /* ---------- MODE CLAIR ---------- */
    :root[data-theme="light"]{--bg:#f8fafc; --panel:#fff; --text:#0f172a; --muted:#475569}
    [data-theme="light"] body{color:var(--text);background:
      radial-gradient(1000px 1000px at 10% -20%, rgba(10,165,122,.08), transparent),
      radial-gradient(1000px 1000px at 110% 10%, rgba(200,162,74,.10), transparent),
      var(--bg)}
    [data-theme="light"] header{background:rgba(255,255,255,.75);border-bottom:1px solid #e2e8f0}
    [data-theme="light"] .nav-links a:hover{background:#f1f5f9}
    @media (max-width:820px){[data-theme="light"] .nav-links{background:rgba(255,255,255,.98);border-bottom:1px solid #e2e8f0}}
    [data-theme="light"] .chip{border-color:#e2e8f0;background:#fff;color:#0f172a}
    [data-theme="light"] .btn.ghost{border-color:#e2e8f0;color:#0f172a}
    [data-theme="light"] .tag{background:#fff;border-color:#e2e8f0;color:#0b8e78}
    [data-theme="light"] .stat{border-color:#e2e8f0;background:#fff}
    [data-theme="light"] .card{background:#fff;border-color:#e2e8f0}
    [data-theme="light"] details{background:#fff;border-color:#e2e8f0}
    [data-theme="light"] details[open]{background:#f8fafc}
    [data-theme="light"] .ph{background:linear-gradient(180deg,#fff,#f8fafc);border-color:#e2e8f0;color:#64748b}
    [data-theme="light"] footer{color:#475569}
    [data-theme="light"] .welcomeColor{color:#192330}
    /* ---------- SWITCH TH√àME ---------- */
    .theme-toggle{
      position:fixed; top:10px; right:12px; z-index:100;
      display:flex; align-items:center; gap:.5rem; font-size:14px;
    }
    .theme-toggle input{position:absolute; opacity:0; pointer-events:none}
    .theme-toggle .switch{display:flex; align-items:center; gap:.5rem; padding:.35rem .5rem; border-radius:999px; background:rgba(11,18,32,.6); border:1px solid #1f2937; backdrop-filter:saturate(140%) blur(6px)}
    .theme-toggle .sun,.theme-toggle .moon{line-height:1}
    .theme-toggle .track{position:relative; width:48px; height:24px; border-radius:999px; background:#0a0f1d; border:1px solid #1f2937}
    .theme-toggle .thumb{position:absolute; top:2px; left:2px; width:20px; height:20px; border-radius:999px; background:linear-gradient(135deg,var(--gold),#ffd57a); box-shadow:0 4px 10px rgba(0,0,0,.25); transition:transform .25s ease}
    #themeSwitch:checked + label .thumb{ transform:translateX(24px) }
    [data-theme="light"] .theme-toggle .switch{background:rgba(255,255,255,.7); border:1px solid #e2e8f0}
    [data-theme="light"] .theme-toggle .track{background:#fff; border-color:#e2e8f0}

    /* ---------- Mobile placement switch ---------- */
    @media (max-width:820px){
      .theme-toggle{top: 15%; left:80%; right:auto; transform:translateX(-50%); z-index: 5;}
    }

    /* ---------- Langues : visibilit√© ---------- */
    html[data-lang="mg"] .i18n-fr{display:none !important}
    html[data-lang="fr"] .i18n-mg{display:none !important}

    /* ---------- S√©lecteur langue ---------- */
    .lang-select{
      appearance:none;background:#0a0f1d;border:1px solid #1f2937;color:#e5e7eb;
      padding:.45rem .6rem;border-radius:10px;font-weight:600;cursor:pointer
    }
    [data-theme="light"] .lang-select{background:#fff;border-color:#e2e8f0;color:#0f172a}

    /* ---------- Bouton Chat sous le switch ---------- */
    .chat-launch{
      position:fixed; right:12px; top:70px; z-index:100;
      padding:.55rem .8rem; border-radius:999px; border:1px solid #1f293700;
      background:#006fd6; color:#e5e7eb; font-weight:700; cursor:pointer;
      box-shadow: #080c0c6c 0px 0px 5px 0px;
    }
    .chatbotgif{
      width:30px; height:30px; vertical-align:middle; margin-right:.4rem;
    }
    .chat-launch:hover{
      transform: translateY(-2px);
      transition: ease-in-out 0.2s;
      box-shadow: #9ffff4 0px 0px 5px 0px;
    }
    [data-theme="light"] .chat-launch{background:#fff;border-color:#e2e8f0;color:#0f172a}
    @media (max-width:820px){
      .chat-launch{ top: calc(10% + 37px); left:10%; transform:translateX(0%); right:auto; z-index: 5; }
    }

    /* ---------- Panneau Chat ---------- */
    .chat-panel{
      position:fixed; right:12px; bottom:16px; width:min(380px,94vw);
      background:var(--panel); color:var(--text); border:1px solid #1f2937;
      border-radius:16px; box-shadow:var(--shadow); display:flex; flex-direction:column; overflow:hidden; z-index:99
    }
    .chat-header{
      display:flex; align-items:center; justify-content:space-between; gap:.6rem;
      padding:.6rem .8rem; border-bottom:1px solid #1f2937; background:rgba(11,18,32,.6)
    }
    .chat-header strong{font-size:.95rem}
    .chat-close{background:transparent;border:0;color:inherit;font-size:1.2rem;cursor:pointer}
    .chat-messages{padding:.8rem; display:flex; flex-direction:column; gap:.6rem; max-height:48vh; overflow:auto}
    .msg{max-width:85%; padding:.6rem .75rem; border-radius:12px; line-height:1.45}
    .msg.user{align-self:flex-end; background:linear-gradient(135deg,var(--brand),var(--brand-2)); color:#fff}
    .msg.bot{align-self:flex-start; background:#0a0f1d; border:1px solid #1f2937}
    [data-theme="light"] .msg.bot{background:#fff;border-color:#e2e8f0}
    .chat-input{display:flex; gap:.5rem; padding:.6rem; border-top:1px solid #1f2937; background:#0a0f1d}
    [data-theme="light"] .chat-input{background:#fff;border-color:#e2e8f0}
    .chat-input input{flex:1; padding:.6rem .75rem; border-radius:10px; border:1px solid #334155; background:#0b1220; color:#e5e7eb}
    [data-theme="light"] .chat-input input{background:#fff; color:#0f172a; border-color:#e2e8f0}
    .chat-input button{padding:.6rem .9rem; border-radius:10px}
    .hidden{display:none !important}
    .tiny{font-size:.8rem;color:#94a3b8}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <nav>
        <div class="brand">
          <img class="logo" src="./MEF_Madagascar_2024.png" alt="Logo MEF" />
          <div>
            <strong>MEF Madagascar</strong><br/>
            <span style="font-size:.84rem;color:#9fb9b3">DGI ¬∑ Centre Fiscal CF3</span>
          </div>
        </div>
        <div class="nav-right">
          <img src="./icons8-menu-48.png" id="menuBtn" class="btn ghost" aria-expanded="false" aria-controls="menu" alt="Menu"/>
          <div id="menu" class="nav-links" role="navigation" aria-label="Navigation principale">
            <a href="#organisation">Organisation</a>
            <a href="#services">D√©marches</a>
            <a href="#is">IS</a>
            <a href="#renouvellement">Renouvellement</a>
            <a href="#attestations">Attestations</a>
            <a href="#contact">Contact</a>
            <!-- Onglet Langue -->
            <label for="lang" style="position:absolute;left:-9999px">Langue</label>
            <select id="lang" class="lang-select" aria-label="Choisir la langue">
              <option value="mg">MG</option>
              <option value="fr">FR</option>
            </select>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <!-- SWITCH th√®me -->
  <div class="theme-toggle" role="group" aria-label="Choix du th√®me">
    <input type="checkbox" id="themeSwitch" aria-label="Basculer clair/sombre">
    <label class="switch" for="themeSwitch">
      <span class="sun" aria-hidden="true">üåô</span>
      <span class="track"><span class="thumb"></span></span>
      <span class="moon" aria-hidden="true">‚òÄÔ∏è</span>
    </label>
  </div>

  <!-- Bouton lancement chat juste sous le switch -->
  <button id="chatOpen" class="chat-launch">üí¨ Posez vos questions</button>

  <!-- Panneau chat -->
  <div id="chatPanel" class="chat-panel hidden" aria-live="polite">
    <div class="chat-header">
      <strong><img src="icons8-chatbot.gif" class="chatbotgif"/>  CF3 ‚Äì IA</strong>
      <button id="chatClose" class="chat-close" aria-label="Fermer">√ó</button>
    </div>
    <div id="chatMessages" class="chat-messages" role="log" aria-live="polite"></div>
    <div class="chat-input">
      <input id="chatInput" type="text" placeholder="Manontania amin‚Äôny teny Malagasy‚Ä¶"/>
      <button id="chatSend" class="btn">Envoyer</button>
    </div>
    <div class="tiny" style="padding:.2rem .8rem .6rem">
      Ceci est un prototype, l'agent IA r√©pond selon sa base de connaissance
    </div>
  </div>

  <main>
    <!-- HERO -->
    <section class="hero">
      <div class="hero-blob" aria-hidden="true"></div>
      <div class="container wrap">
        <div class="kicker">
          <span class="chip">Portail d‚Äôinformation</span>
          <span class="chip">Version d√©mo ‚Äì single file</span>
          <span class="chip">FR ¬∑ MG</span>
        </div>
        <h1>Minist√®re de l‚Äô√âconomie & des Finances ¬∑ <span style="color:var(--gold)">Direction G√©n√©rale des Imp√¥ts</span></h1>
        <p class="lead i18n-mg welcomeColor" >Tongasoa eto amin‚Äôny pejin‚Äôny <strong>Centre Fiscal CF3</strong>, ao anatin‚Äôny DGI/MEF. Hahita mazava eto ianao ny <em>antontan-taratasy ilaina</em>, ny <em>dingana</em> ary ny <em>fifandraisana</em> amin‚Äôny raharaha (NIF, fanambarana <abbr title="Imp√¥t sur les Soci√©t√©s">IS</abbr>, kara-fisitra, taratasy fanamarinana, sns.).</p>
        <p class="lead i18n-fr welcomeColor">Bienvenue sur le site d‚Äôinformation du <strong>Centre Fiscal CF3</strong> (DGI/MEF). Retrouvez clairement <em>les pi√®ces √† fournir</em>, <em>les √©tapes</em> et <em>les contacts</em> pour vos d√©marches (NIF, d√©claration <abbr title="Imp√¥t sur les Soci√©t√©s">IS</abbr>, carte fiscale, attestations, etc.).</p>
        <div class="stats">
          <div class="stat">4 divisions : <strong>Contr√¥le ¬∑ Enregistrement ¬∑ Accueil ¬∑ Recette</strong></div>
          <div class="stat">Horaires CF3 : <strong>08:00‚Äì16:00</strong> (Lun‚ÄìVen)</div>
        </div>
        <div style="display:flex;gap:.6rem;flex-wrap:wrap;margin-top:1rem">
          <a class="btn" href="#services">Voir les d√©marches</a>
          <button class="btn ghost" onclick="window.print()">Imprimer la page</button>
        </div>
      </div>
    </section>

    <!-- ORGANISATION -->
    <section id="organisation">
      <div class="container">
        <div class="title">
          <h2>Organisation ¬∑ DGI & CF3 <span class="tag">Fandaminana</span></h2>
          <small>Le CF3 est rattach√© √† la DGI (MEF). Il comprend 4 divisions op√©rationnelles.</small>
        </div>
        <div class="grid cols-4 reveal">
          <article class="card"><h3>Accueil</h3><p>R√©ception, information, orientation des contribuables, prise de rendez-vous.</p></article>
          <article class="card"><h3>Enregistrement</h3><p>Immatriculation (NIF), tenue des dossiers, d√©livrance des cartes fiscales.</p></article>
          <article class="card"><h3>Recette</h3><p>Encaissement, bordereaux, quittances et suivi des paiements.</p></article>
          <article class="card"><h3>Contr√¥le</h3><p>V√©rification, conformit√© documentaire et contr√¥le fiscal cibl√©.</p></article>
        </div>
      </div>
    </section>

    <!-- SERVICES (MG par d√©faut / FR via select) -->
    <section id="services">
      <div class="container">
        <!-- ancres -->
        <div id="is"></div>
        <div id="renouvellement"></div>
        <div id="attestations"></div>

        <!-- MG -->
        <div class="i18n-mg">
          <div class="title">
            <h2>Serivisy & Dingana</h2>
            <small>Safidio ny sokajy hijerena ny antontan-taratasy sy dingana.</small>
          </div>

          <!-- NIFONLINE -->
          <details class="reveal" open>
            <summary>
              <svg class="icon chev" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
              <strong class="epingleContent"><img src="icons8-√©pingle-50.png" class="epingle"/>Fisoratana anarana amin‚Äôny NIFONLINE</strong>
            </summary>
            <div class="grid cols-2" style="margin-top:.8rem">
              <div class="card">
                <h3>Ho an‚Äôny olon-tsotra</h3>
                <ul>
                  <li>Original sy kopian‚Äôny <strong>Kara-panondrom-pirenena (CIN)</strong></li>
                  <li><strong>Kara-mponina</strong> ho an‚Äôny vahiny</li>
                  <li><strong>Taratasy fanamarinam-ponenana</strong> sy/na <strong>faktioran‚Äôny JIRAMA</strong> (&lt; 3 volana)</li>
                  <li><strong>Sarin-toerana</strong> (plan de rep√©rage) voamarina amin‚Äôny sefom-pokontany</li>
                  <li><strong>Rosia</strong> sy <strong>taratasy fandoavana</strong> ny <strong>IS</strong> na <strong>IR</strong></li>
                  <li><strong>Kara-panjakana (carte statistique)</strong></li>
                  <li><strong>Taratasy fananan-trano</strong> (na fifanarahana <em>fanofana/domiciliation</em>)</li>
                  <li><strong>Taratasy fanomezan-dalana</strong> voamarin‚Äôny manam-pahefana raha solontena</li>
                  <li>Antontan-taratasy hafa (fahazoan-dalana ministera, kara-grisa, licence)</li>
                  <li><strong>Laharana fanondroana</strong> ny fangatahana</li>
                </ul>
              </div>
              <div class="card">
                <h3>Ho an‚Äôny orinasa (Personnes morales)</h3>
                <ul>
                  <li><strong>Fitsipiky ny fiaraha-miasa (Statuts)</strong></li>
                  <li>Original sy kopian‚Äôny <strong>CIN</strong> an‚Äôny tompon‚Äôandraikitra voalohany</li>
                  <li><strong>Kara-mponina</strong> & <strong>CIPENS</strong> ho an‚Äôny vahiny</li>
                  <li><strong>Taratasy fanamarinam-ponenana</strong> an‚Äôny tompon‚Äôandraikitra voalohany sy/na <strong>faktioran‚Äôny JIRAMA</strong> (&lt; 3 volana)</li>
                  <li><strong>Sarin-toerana</strong> voamarina amin‚Äôny sefom-pokontany</li>
                  <li><strong>Taratasy fanamarinana fisian‚Äôny orinasa</strong> (certificat d‚Äôexistence)</li>
                  <li><strong>Rosia</strong> sy <strong>taratasy fandoavana</strong> ny IS</li>
                  <li><strong>Kara-panjakana</strong></li>
                  <li><strong>Taratasy fananan-trano</strong> (fifanekena fanofana, domiciliation, taratasy famindram-ponenana)</li>
                  <li><strong>Taratasy fanomezan-dalana</strong> voamarin‚Äôny manam-pahefana raha solontena</li>
                  <li>Antontan-taratasy hafa (fahazoan-dalana ministera, kara-grisa, licence)</li>
                  <li><strong>Laharana fanondroana</strong> ny fangatahana</li>
                </ul>
              </div>
            </div>
          </details>

          <!-- IS -->
          <details class="reveal">
            <summary>
              <svg class="icon chev" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
              <strong class="epingleContent"><img src="icons8-√©pingle-50.png" class="epingle" > Fanambarana ny HETRA IS (Imp√¥t sur les Soci√©t√©s)</strong>
            </summary>
            <div class="card" style="margin-top:.8rem">
              <h3>Antontan-taratasy ilaina</h3>
              <ul>
                <li><strong>Taratasy fanambarana</strong> (omen‚Äôny CF3) ‚Äì <em>3 dika mitovy</em></li>
                <li><strong>Kara-fisitra</strong></li>
                <li><strong>Kara-panjakana (statistique)</strong></li>
                <li><strong>Faktioran‚Äôny JIRAMA</strong> (raha tompon-trano)</li>
                <li><strong>Kopian‚Äôny livret de famille</strong> na <strong>CIN</strong> (raha anaran‚Äôny ray aman-dreny maty no faktiora ‚Üí <em>mila porofo maha-olona akaiky</em>)</li>
              </ul>
            </div>
          </details>

          <!-- Renouvellement -->
          <details class="reveal">
            <summary>
              <svg class="icon chev" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
              <strong><img src="icons8-√©pingle-50.png" class="epingle" > Fanavaozana Kara-Fisitra</strong>
            </summary>
            <div class="card" style="margin-top:.8rem">
              <ul>
                <li><strong>Fanavaozana amin‚Äôny NIFONLINE</strong></li>
                <li><strong>Rosia IS</strong> (3 dika) miaraka amin‚Äôny <strong>vola miditra 3 taona farany</strong></li>
              </ul>
              <p class="muted" style="color:#94a3b8;margin:.6rem 0 0"><strong>Fanamarihana</strong> : Raha misy fiovana eo amin‚Äôny asa atao, dia tsy maintsy havaozina amin‚Äôny <strong>NIFONLINE</strong>.</p>
            </div>
          </details>

          <!-- Attestations MG -->
          <details class="reveal" id="attestations-mg">
            <summary>
              <svg class="icon chev" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
              <strong class="epingleContent"><img src="icons8-√©pingle-50.png" class="epingle" > Taratasy fanamarinana & Taratasy ofisialy</strong>
            </summary>
            <div class="grid cols-2" style="margin-top:.8rem">
              <div class="card">
                <h3>Tsy mandoa hetra (fiara)</h3>
                <ul>
                  <li>Fangatahana an-tsoratra</li>
                  <li><strong>Kara-grisa</strong> (original + kopia)</li>
                  <li><strong>Taratasy fanamarinana</strong> farany</li>
                  <li><strong>Karatra fisotroan-dronono</strong> / taratasy fandoavam-bola / <strong>kara-fisitra</strong></li>
                  <li><strong>Taratasy fanamarinam-ponenana</strong></li>
                  <li><strong>Kopia CIN</strong></li>
                </ul>
              </div>
              <div class="card">
                <h3>Maha-Resident fiscal</h3>
                <ul>
                  <li>Fangatahana + <strong>fanambarana amin‚Äôny voninahitra</strong> (vola miditra eto an-toerana & any ivelany)</li>
                  <li><strong>Kara-mponina</strong></li>
                  <li><strong>Kara-panondro matihanina</strong> (raha manao asa)</li>
                  <li><strong>Tatitra karama</strong></li>
                  <li><strong>Taratasy sy rosia fandoavam-bola</strong> (manokana na an‚Äôny orinasa)</li>
                  <li><strong>Lisitry ny mpandray tombontsoa</strong></li>
                </ul>
              </div>
              <div class="card">
                <h3>Fandoavana IRSA</h3>
                <ul>
                  <li>Fangatahana an-tsoratra (<strong>indroa</strong>)</li>
                  <li>Dika mitovy <strong>fanambarana IRSA</strong> + rosia sy tatitra</li>
                  <li><strong>Kara-fisitra</strong> an‚Äôny mpampiasa</li>
                  <li><strong>Taratasy fanamarinam-ponenan‚Äôny mpiasa</strong></li>
                  <li><strong>Kopia CIN</strong> an‚Äôny mpiasa</li>
                  <li><strong>Taratasy fanomezan-dalana</strong> raha solontena</li>
                  <li><strong>Nomeraon-telefaonina</strong> an‚Äôilay mpangataka</li>
                </ul>
              </div>
              <div class="card">
                <h3>Tsy mandoa hetra (fidiram-bola/synth√©tique)</h3>
                <ul>
                  <li>Fangatahana an-tsoratra (<strong>indroa</strong>)</li>
                  <li><strong>Kopia</strong> ny taratasy fanamarinana farany</li>
                  <li><strong>Taratasy fanamarinam-ponenana</strong></li>
                  <li><strong>Taratasy avy amin‚Äôny mpiantoka</strong> voamarina (sefom-pokontany)</li>
                  <li><strong>Karatra fisotroan-dronono</strong> (raha misotro ronono)</li>
                  <li><strong>Taratasy fanamarinana tsy an‚Äôasa</strong> (raha tsy miasa)</li>
                  <li><strong>Kopia CIN</strong></li>
                </ul>
              </div>
            </div>
          </details>

          <!-- Fampitsaharana / Licences -->
          <details class="reveal">
            <summary>
              <svg class="icon chev" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
              <strong class="epingleContent"><img src="icons8-√©pingle-50.png" class="epingle" > Fampitsaharana asa (PM)</strong>
            </summary>
            <div class="card" style="margin-top:.8rem">
              <ul>
                <li><strong>Tatitry ny famaranana ara-bola</strong> voasonia</li>
                <li><strong>Statuts</strong> ny orinasa</li>
                <li><strong>Fangatahana fampitsaharana</strong> (<strong>indroa</strong>)</li>
                <li><strong>PV famaranana</strong> voasoratra</li>
                <li><strong>Kopia IS/IR farany</strong> + rosia</li>
                <li><strong>Taratasy fananan-trano</strong> (titre na r√¥le IFPB)</li>
                <li><strong>Fifanekena fanofana farany</strong> (na fanafoanana)</li>
                <li><strong>Famerenana ny kara-fisitra</strong></li>
                <li><strong>Fanambarana rehetra</strong> (IRSA, IS, IR, TVA, licence) ho ara-dal√†na</li>
              </ul>
            </div>
          </details>

          <details class="reveal" id="renouvellement-mg">
            <summary>
              <svg class="icon chev" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
              <strong class="epingleContent"><img src="icons8-√©pingle-50.png" class="epingle" > Fahazoan-dalana & Licence (oh: toaka)</strong>
            </summary>
            <div class="card" style="margin-top:.8rem">
              <ul>
                <li><strong>Fiche de renseignement</strong> avy amin‚Äôny sefom-pokontany</li>
                <li><strong>CIN</strong> (original sy kopia)</li>
                <li><strong>Casier judiciaire</strong> &lt; 3 volana</li>
                <li><strong>Taratasy fanamarinam-ponenana</strong></li>
                <li><strong>Sarin-toerana</strong> voamarina</li>
                <li><strong>Sarin‚Äôny toerana</strong> (efitrano fivarotana/fisotroana)</li>
                <li><strong>Rosia FIPB</strong> na <strong>taratasy fananan-trano</strong></li>
                <li><strong>Fitsipika</strong> + fanendrena ny tale (raha orinasa)</li>
                <li><strong>D√©rogation sp√©ciale</strong> (raha ilaina)</li>
              </ul>
            </div>
          </details>
        </div>

        <!-- FR -->
        <div class="i18n-fr">
          <div class="title">
            <h2>Services & D√©marches</h2>
            <small>Choisissez une rubrique pour voir les pi√®ces √† fournir et les √©tapes.</small>
          </div>

          <!-- NIFONLINE -->
          <details class="reveal" open>
            <summary>
              <svg class="icon chev" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
              <strong class="epingleContent"><img src="icons8-√©pingle-50.png" class="epingle" > Immatriculation sur NIFONLINE</strong>
            </summary>
            <div class="grid cols-2" style="margin-top:.8rem">
              <div class="card">
                <h3>Pour les personnes physiques</h3>
                <ul>
                  <li>Original et <strong>copie de la CIN</strong></li>
                  <li><strong>Carte de r√©sident</strong> pour les √©trangers</li>
                  <li><strong>Certificat de r√©sidence</strong> et/ou <strong>facture JIRAMA</strong> (&lt; 3 mois)</li>
                  <li><strong>Plan de rep√©rage</strong> vis√© par le Chef Fokontany</li>
                  <li><strong>R√©c√©piss√© et bordereau</strong> de versement de l‚Äô<strong>IS</strong> ou de l‚Äô<strong>IR</strong></li>
                  <li><strong>Carte statistique</strong></li>
                  <li><strong>Titre de propri√©t√© du local</strong> (ou bail/domiciliation)</li>
                  <li><strong>Procuration l√©galis√©e</strong> si repr√©sentant</li>
                  <li>Autres pi√®ces originales (autorisation minist√©rielle, carte grise, licence)</li>
                  <li><strong>R√©f√©rence de la demande</strong></li>
                </ul>
              </div>
              <div class="card">
                <h3>Pour les personnes morales</h3>
                <ul>
                  <li><strong>Statuts de la soci√©t√©</strong></li>
                  <li>Original et <strong>copie de la CIN</strong> du premier responsable</li>
                  <li><strong>Carte de r√©sident</strong> et <strong>CIPENS</strong> pour les √©trangers</li>
                  <li><strong>Certificat de r√©sidence</strong> du premier responsable et/ou <strong>facture JIRAMA</strong> (&lt; 3 mois)</li>
                  <li><strong>Plan de rep√©rage</strong> vis√© par le chef Fokontany</li>
                  <li><strong>Certificat d‚Äôexistence</strong></li>
                  <li><strong>R√©c√©piss√© et bordereau</strong> de versement de l‚ÄôIS</li>
                  <li><strong>Carte statistique</strong></li>
                  <li><strong>Titre de propri√©t√© du local</strong> (bail, domiciliation, lettre d‚Äôoccupation)</li>
                  <li><strong>Procuration l√©galis√©e</strong> si repr√©sentant</li>
                  <li>Autres pi√®ces originales (autorisation minist√©rielle, carte grise, licence)</li>
                  <li><strong>R√©f√©rence de la demande</strong></li>
                </ul>
              </div>
            </div>
          </details>

          <!-- IS -->
          <details class="reveal">
            <summary>
              <svg class="icon chev" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
              <strong class="epingleContent"><img src="icons8-√©pingle-50.png" class="epingle" > D√©claration d‚ÄôImp√¥t sur les Soci√©t√©s (IS)</strong>
            </summary>
            <div class="card" style="margin-top:.8rem">
              <h3>Dossier √† fournir</h3>
              <ul>
                <li><strong>Formulaire de d√©claration</strong> (fourni au CF3) ‚Äì <em>3 exemplaires</em></li>
                <li><strong>Carte fiscale</strong></li>
                <li><strong>Carte statistique</strong></li>
                <li><strong>Facture JIRAMA</strong> (si propri√©taire)</li>
                <li><strong>Photocopie livret de famille</strong> ou <strong>CIN</strong> (si la facture est au nom d‚Äôun parent d√©c√©d√© ‚Üí <em>justificatif de filiation obligatoire</em>)</li>
              </ul>
            </div>
          </details>

          <!-- Renouvellement -->
          <details class="reveal">
            <summary>
              <svg class="icon chev" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
              <strong class="epingleContent"><img src="icons8-√©pingle-50.png" class="epingle" > Renouvellement de Carte Fiscale</strong>
            </summary>
            <div class="card" style="margin-top:.8rem">
              <ul>
                <li><strong>Mise √† jour sur NIFONLINE</strong></li>
                <li><strong>Bordereaux d‚ÄôIS</strong> (3 exemplaires) avec le <strong>chiffre d‚Äôaffaires des 3 derni√®res ann√©es</strong></li>
              </ul>
              <p class="muted" style="color:#94a3b8;margin:.6rem 0 0"><strong>NB</strong> : Toute modification de l‚Äôactivit√© doit √™tre d√©clar√©e via <strong>NIFONLINE</strong>.</p>
            </div>
          </details>

          <!-- Attestations FR -->
          <details class="reveal">
            <summary>
              <svg class="icon chev" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
              <strong class="epingleContent"><img src="icons8-√©pingle-50.png" class="epingle" > Attestations & Certificats</strong>
            </summary>
            <div class="grid cols-2" style="margin-top:.8rem">
              <div class="card">
                <h3>Non-imposition (v√©hicule)</h3>
                <ul>
                  <li><strong>Demande</strong> sur papier libre</li>
                  <li><strong>Carte grise</strong> (originale + photocopie)</li>
                  <li>Derni√®re attestation</li>
                  <li><strong>Bulletin de paie</strong> / <strong>avis de cr√©dit</strong> / <strong>carte fiscale</strong></li>
                  <li><strong>Certificat de r√©sidence</strong></li>
                  <li><strong>Photocopie CIN</strong></li>
                </ul>
              </div>
              <div class="card">
                <h3>R√©sident fiscal</h3>
                <ul>
                  <li>Demande + <strong>d√©claration sur l‚Äôhonneur</strong> (revenus locaux & √©trangers)</li>
                  <li><strong>Carte de r√©sident</strong></li>
                  <li>Carte d‚Äôidentit√© professionnelle (si activit√©)</li>
                  <li><strong>Fiche de paie</strong></li>
                  <li><strong>D√©clarations & re√ßus d‚Äôimp√¥ts</strong> (perso/soci√©t√©)</li>
                  <li><strong>Liste des b√©n√©ficiaires</strong> de revenus</li>
                </ul>
              </div>
              <div class="card">
                <h3>Paiement d‚ÄôIRSA</h3>
                <ul>
                  <li><strong>Demande</strong> sur papier libre (<strong>x2</strong>)</li>
                  <li>Copies <strong>d√©clarations IRSA</strong> + <strong>re√ßus</strong> + <strong>√©tats nominatifs</strong></li>
                  <li><strong>Carte fiscale</strong> de l‚Äôemployeur</li>
                  <li><strong>Certificat de r√©sidence</strong> de l‚Äôemploy√©</li>
                  <li><strong>CIN</strong> de l‚Äôemploy√© (photocopie)</li>
                  <li><strong>Procuration l√©galis√©e</strong> si repr√©sentant</li>
                  <li><strong>Contact t√©l√©phonique</strong> du demandeur</li>
                </ul>
              </div>
              <div class="card">
                <h3>Non-imposition (revenus/synth√©tique)</h3>
                <ul>
                  <li><strong>Demande</strong> sur papier libre (<strong>x2</strong>)</li>
                  <li><strong>Photocopie de la derni√®re attestation</strong></li>
                  <li><strong>Certificat de r√©sidence</strong></li>
                  <li><strong>Lettre du tuteur</strong> (prise en charge) vis√©e par le Fokontany</li>
                  <li><strong>Carte de pension</strong> (si retrait√©)</li>
                  <li><strong>Attestation de ch√¥mage</strong> (si ch√¥meur)</li>
                  <li><strong>CIN</strong> (photocopie)</li>
                </ul>
              </div>
            </div>
          </details>

          <!-- Cessation / Licences -->
          <details class="reveal">
            <summary>
              <svg class="icon chev" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
              <strong class="epingleContent"><img src="icons8-√©pingle-50.png" class="epingle" > Cessation d‚Äôactivit√© (Personnes morales)</strong>
            </summary>
            <div class="card" style="margin-top:.8rem">
              <ul>
                <li><strong>Bilan de cl√¥ture</strong> sign√© par le g√©rant/liquidateur</li>
                <li><strong>Statuts</strong> de la soci√©t√©</li>
                <li><strong>Lettre de demande de cessation</strong> (3 exemplaires)</li>
                <li><strong>PV de dissolution</strong> enregistr√©</li>
                <li><strong>Photocopie de la derni√®re d√©claration IS/IR</strong> avec r√©c√©piss√©s</li>
                <li><strong>Justificatif de propri√©t√©</strong> (titre ou r√¥le IFPB)</li>
                <li><strong>Dernier contrat de bail</strong> (ou lettre de r√©siliation)</li>
                <li><strong>Restitution de la carte fiscale</strong></li>
                <li><strong>Toutes les d√©clarations fiscales</strong> (IRSA, IS, IR, TVA, licence) doivent √™tre en r√®gle</li>
              </ul>
            </div>
          </details>

          <details class="reveal">
            <summary>
              <svg class="icon chev" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
              <strong class="epingleContent"><img src="icons8-√©pingle-50.png" class="epingle" > Licences & Autorisations (ex. boissons alcoolis√©es)</strong>
            </summary>
            <div class="card" style="margin-top:.8rem">
              <ul>
                <li><strong>Fiche de renseignement</strong> sign√©e par le chef Fokontany</li>
                <li><strong>CIN</strong> (originale et copie)</li>
                <li><strong>Casier judiciaire</strong> (&lt; 3 mois)</li>
                <li><strong>Certificat de r√©sidence</strong></li>
                <li><strong>Plan de rep√©rage</strong> vis√© par Fokontany</li>
                <li><strong>Plan du local</strong> (salle de vente/consommation)</li>
                <li><strong>Quittance FIPB</strong> ou <strong>titre de propri√©t√©</strong></li>
                <li><strong>Statut</strong> + <strong>nomination du g√©rant</strong> (si soci√©t√©)</li>
                <li><strong>D√©rogation sp√©ciale</strong> (si n√©cessaire)</li>
              </ul>
            </div>
          </details>
        </div>
      </div>
    </section>

    <!-- CONTACT -->
    <section id="contact">
      <div class="container">
        <div class="title">
          <h2>Contact & rendez-vous <span class="tag">Fifandraisana</span></h2>
          <small>CF3 ¬∑ DGI ‚Äì MEF. Merci de venir avec un dossier complet pour un traitement rapide.</small>
        </div>
        <div class="grid cols-2 reveal">
          <div class="card">
            <h3>Coordonn√©es</h3>
            <ul>
              <li><strong>Centre Fiscal CF3</strong>, Direction G√©n√©rale des Imp√¥ts</li>
              <li>Heures : Lun‚ÄìVen 08:00‚Äì16:00</li>
              <li>Email : <a href="mailto:contact@dgi-cf3.gov.mg">contact@dgi-cf3.gov.mg</a> (exemple)</li>
              <li>T√©l√©phone : 020 00 000 00 (exemple)</li>
            </ul>
            <p class="muted" style="color:#94a3b8">R√©f√©rent contenu : <strong>Erina</strong> (CF3).</p>
            <div style="display:flex;gap:.6rem;flex-wrap:wrap">
              <button class="btn ghost" id="openModal">Prendre rendez-vous</button>
            </div>
          </div>
          <div class="card">
            <h3>Carte ¬∑ MEF Madagascar</h3>
            <div style="border-radius:12px;overflow:hidden;border:1px solid #1f2937">
              <iframe
                title="MEF Madagascar"
                width="100%" height="280" style="border:0"
                loading="lazy" referrerpolicy="no-referrer-when-downgrade"
                src="https://www.google.com/maps?q=Minist%C3%A8re%20de%20l%E2%80%99%C3%89conomie%20et%20des%20Finances%20Madagascar%20Antananarivo&z=15&output=embed">
              </iframe>
            </div>
            <p style="margin:.6rem 0 0">
              <a href="https://www.google.com/maps/search/?api=1&query=MEF+Madagascar+Antananarivo" target="_blank" rel="noopener">Voir sur Google Maps ‚Üó</a>
            </p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <div style="display:flex;justify-content:space-between;gap:1rem;flex-wrap:wrap">
        <p>¬© <span id="year"></span> MEF ‚Äì DGI/CF3 (Prototype). Ce site est une <strong>d√©mo</strong></p>
        <div><a href="#" onclick="window.scrollTo({top:0,behavior:'smooth'})">‚Üë Haut de page</a></div>
      </div>
    </div>
  </footer>

  <!-- Rendez-vous modal -->
  <dialog id="modal" style="border:none;border-radius:16px;background:#0b1220;color:#e5e7eb;padding:0;max-width:520px;box-shadow:var(--shadow)">
    <form method="dialog" style="padding:1.2rem">
      <h3 style="margin-top:0">Prendre rendez-vous</h3>
      <p>Remplissez ces champs (d√©mo ‚Äì aucune donn√©e n‚Äôest transmise).</p>
      <div class="grid cols-2">
        <label>Nom<br/><input required type="text" style="width:100%;padding:.8rem;border-radius:10px;border:1px solid #334155;background:#0a0f1d;color:#e5e7eb"></label>
        <label>Pr√©nom<br/><input required type="text" style="width:100%;padding:.8rem;border-radius:10px;border:1px solid #334155;background:#0a0f1d;color:#e5e7eb"></label>
      </div>
      <div class="grid cols-2" style="margin-top:.6rem">
        <label>Email<br/><input type="email" style="width:100%;padding:.8rem;border-radius:10px;border:1px solid #334155;background:#0a0f1d;color:#e5e7eb"></label>
        <label>T√©l√©phone<br/><input type="tel" style="width:100%;padding:.8rem;border-radius:10px;border:1px solid #334155;background:#0a0f1d;color:#e5e7eb"></label>
      </div>
      <label style="display:block;margin-top:.6rem">Objet du rendez-vous
        <select style="width:100%;padding:.8rem;border-radius:10px;border:1px solid #334155;background:#0a0f1d;color:#e5e7eb">
          <option>D√©claration IS</option>
          <option>Immatriculation NIF</option>
          <option>Renouvellement carte fiscale</option>
          <option>Attestation / Certificat</option>
          <option>Autre</option>
        </select>
      </label>
      <div style="display:flex;justify-content:flex-end;gap:.6rem;margin-top:1rem">
        <button class="btn ghost" value="cancel">Annuler</button>
        <button class="btn" value="ok">Valider</button>
      </div>
    </form>
  </dialog>

  <script>
    /* ---------- Menu mobile ---------- */
    const menuBtn = document.getElementById('menuBtn');
    const menu = document.getElementById('menu');
    menuBtn?.addEventListener('click', ()=>{
      const open = menu.classList.toggle('open');
      menuBtn.setAttribute('aria-expanded', open);
    });

    /* ---------- Ann√©e footer ---------- */
    document.getElementById('year').textContent = new Date().getFullYear();

    /* ---------- Reveal on scroll ---------- */
    const io = new IntersectionObserver((els)=>{
      els.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('show'); io.unobserve(e.target);} })
    },{threshold:.15});
    document.querySelectorAll('.reveal').forEach(el=>io.observe(el));

    /* ---------- Th√®me clair/sombre ---------- */
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const themeSwitch = document.getElementById('themeSwitch');
    function applyTheme(t){
      document.documentElement.setAttribute('data-theme', t);
      localStorage.setItem('theme', t);
      if(metaTheme) metaTheme.setAttribute('content', t === 'light' ? '#ffffff' : '#0b8e78');
      if(themeSwitch) themeSwitch.checked = (t === 'light');
    }
    const savedTheme = localStorage.getItem('theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
    applyTheme(savedTheme);
    themeSwitch?.addEventListener('change', ()=> applyTheme(themeSwitch.checked ? 'light' : 'dark'));

    /* ---------- Langue MG/FR ---------- */
    const langSel = document.getElementById('lang');
    function applyLang(l){
      document.documentElement.setAttribute('data-lang', l);
      document.documentElement.lang = l;
      localStorage.setItem('lang', l);
      if(langSel) langSel.value = l;
      // Placeholder chat + bienvenue
      const chatInput = document.getElementById('chatInput');
      if(chatInput){
        chatInput.placeholder = (l==='fr') ? 'Posez une question‚Ä¶' : 'Manontania amin‚Äôny teny Malagasy‚Ä¶';
      }
    }
    const savedLang = localStorage.getItem('lang') || 'mg';
    applyLang(savedLang);
    langSel?.addEventListener('change', ()=> applyLang(langSel.value));

    /* ---------- Modal rendez-vous ---------- */
    const modal = document.getElementById('modal');
    document.getElementById('openModal')?.addEventListener('click', ()=> modal.showModal());
    modal?.addEventListener('close', ()=>{ if(modal.returnValue === 'ok') alert('Demande de rendez-vous enregistr√©e (d√©mo).'); });

    /* ---------- CHATBOT CF3 (Groq) ---------- */
    const GROQ_API_KEY = "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";
    const GROQ_URL = "https://api.groq.com/openai/v1/chat/completions";
    // Nouveau mod√®le recommand√© (ancien "llama3-8b-8192" d√©commissionn√©)
    const MODEL_PRIMARY = "llama-3.1-8b-instant";
    const MODEL_FALLBACKS = ["llama-3.1-70b-versatile"];
    // Base de connaissances minimale (FR + MG) inject√©e au mod√®le
    const KB_FR = `
Vous √™tes un agent d'information pour le CF3 (DGI/MEF ‚Äì Madagascar).
Repondez UNIQUEMENT √† partir de ces points. Si la question sort du p√©rim√®tre, dites que l'info n'est pas disponible ici.

‚Äî Immatriculation NIFONLINE (Personnes physiques) :
‚Ä¢ CIN (original + copie) ‚Ä¢ Carte de r√©sident (√©trangers)
‚Ä¢ Certificat de r√©sidence et/ou Facture JIRAMA (< 3 mois)
‚Ä¢ Plan de rep√©rage vis√© Fokontany
‚Ä¢ R√©c√©piss√© + bordereau de versement IS/IR
‚Ä¢ Carte statistique
‚Ä¢ Titre de propri√©t√© du local (ou bail/domiciliation)
‚Ä¢ Procuration l√©galis√©e si repr√©sentant
‚Ä¢ Autres pi√®ces originales (autorisation minist√©rielle, carte grise, licence)
‚Ä¢ R√©f√©rence de la demande

‚Äî Immatriculation NIFONLINE (Personnes morales) :
‚Ä¢ Statuts ‚Ä¢ CIN du 1er responsable (original+copie)
‚Ä¢ Carte de r√©sident & CIPENS (√©trangers)
‚Ä¢ Certificat de r√©sidence du 1er resp. et/ou Facture JIRAMA (< 3 mois)
‚Ä¢ Plan de rep√©rage vis√© Fokontany ‚Ä¢ Certificat d‚Äôexistence
‚Ä¢ R√©c√©piss√© + bordereau IS ‚Ä¢ Carte statistique
‚Ä¢ Titre de propri√©t√© (bail/domiciliation/lettre d‚Äôoccupation)
‚Ä¢ Procuration l√©galis√©e si repr√©sentant
‚Ä¢ Autres pi√®ces originales (autorisation minist√©rielle, carte grise, licence)
‚Ä¢ R√©f√©rence de la demande

‚Äî D√©claration IS (dossier) :
‚Ä¢ Formulaire CF3 (3 ex) ‚Ä¢ Carte fiscale ‚Ä¢ Carte statistique
‚Ä¢ Facture JIRAMA (si propri√©taire)
‚Ä¢ Livret de famille ou CIN si facture au nom d‚Äôun parent d√©c√©d√© (justificatif de filiation)

‚Äî Renouvellement Carte fiscale :
‚Ä¢ MAJ sur NIFONLINE ‚Ä¢ Bordereaux IS (3 ex) + CA des 3 derni√®res ann√©es
NB : toute modification d‚Äôactivit√© ‚Üí via NIFONLINE.

‚Äî Attestations :
(Non-imposition v√©hicule) : Demande libre, carte grise (orig+copie), derni√®re attestation, bulletin de paie/avis de cr√©dit/carte fiscale, certificat de r√©sidence, copie CIN.
(R√©sident fiscal) : Demande + d√©claration sur l‚Äôhonneur revenus (locaux/√©trangers), carte de r√©sident, carte d‚Äôidentit√© professionnelle (si activit√©), fiche de paie, d√©clarations & re√ßus d‚Äôimp√¥ts (perso/soci√©t√©), liste des b√©n√©ficiaires.
(Paiement IRSA) : Demande x2, copies d√©clarations IRSA + re√ßus + √©tats nominatifs, carte fiscale employeur, certificat de r√©sidence employ√©, CIN (copie), procuration si repr√©sentant, contact t√©l.
(Non-imposition revenus/synth√©tique) : Demande x2, copie derni√®re attestation, certificat de r√©sidence, lettre du tuteur vis√©e Fokontany, carte de pension (si retrait√©), attestation de ch√¥mage (si ch√¥meur), CIN (copie).

‚Äî Cessation (PM) :
Bilan de cl√¥ture sign√©, Statuts, Lettre de cessation (3 ex), PV de dissolution enregistr√©, copie derni√®re IS/IR + r√©c√©piss√©s, justificatif de propri√©t√© (titre/r√¥le IFPB), dernier bail (ou r√©siliation), restitution carte fiscale, toutes d√©clarations (IRSA, IS, IR, TVA, licence) en r√®gle.

‚Äî Licences/Autorisations (ex. boissons alcoolis√©es) :
Fiche de renseignement sign√©e Fokontany, CIN (orig+copie), casier judiciaire <3 mois, certificat de r√©sidence, plan de rep√©rage vis√© Fokontany, plan du local, quittance FIPB ou titre de propri√©t√©, statut + nomination du g√©rant (si soci√©t√©), d√©rogation sp√©ciale si n√©cessaire.

R√®gles :
1) R√©pondre dans la langue demand√©e (FR si la question est en FR, MG si MG). Si non pr√©cis√©, utiliser la langue s√©lectionn√©e dans le site.
2) Si l‚Äôutilisateur demande √† aller √† une page (Accueil, Services, Contact), ajouter EN FIN DE R√âPONSE une ligne : page= Accueil|Services|Contact (ou page= None si rien).
3) Rester concis et pratique.`;

    const KB_MG = `
Ianao no agent d'information ho an'ny CF3 (DGI/MEF ‚Äì Madagasikara).
Valio miorina AMIN'IRETO ihany. Raha mihoatra io fangatahana io, lazao fa tsy ampy ny vaovao eto.

‚Äî Fisoratana anarana NIFONLINE (Olon-tsotra) :
‚Ä¢ CIN (original+kop.) ‚Ä¢ Kara-mponina (vahiny)
‚Ä¢ Fanamarinam-ponenana sy/na Faktiora JIRAMA (< 3 vol.)
‚Ä¢ Sarin-toerana nosoniavin'ny sefom-pokontany
‚Ä¢ Rosia + taratasy fandoavana IS/IR
‚Ä¢ Kara-panjakana (statistique)
‚Ä¢ Taratasy fananan-trano (na bail/domiciliation)
‚Ä¢ Procuration l√©galiz√©e raha solontena
‚Ä¢ Antontan-taratasy hafa (fahazoan-dalana ministera, kara-grisa, licence)
‚Ä¢ Laharana fanondroana

‚Äî Fisoratana anarana NIFONLINE (Orinasa) :
‚Ä¢ Statuts ‚Ä¢ CIN 1er responsable (orig+kop.)
‚Ä¢ Kara-mponina & CIPENS (vahiny)
‚Ä¢ Fanamarinam-ponenana 1er responsable sy/na JIRAMA (< 3 vol.)
‚Ä¢ Sarin-toerana voamarina ‚Ä¢ Certificat d‚Äôexistence
‚Ä¢ Rosia + bordereau IS ‚Ä¢ Kara-panjakana
‚Ä¢ Taratasy fananan-trano (bail/domiciliation/lettre d‚Äôoccupation)
‚Ä¢ Procuration l√©galiz√©e raha solontena
‚Ä¢ Antontan-taratasy hafa (ministera, kara-grisa, licence)
‚Ä¢ Laharana fanondroana

‚Äî Fanambarana IS :
‚Ä¢ Taratasy fanambarana CF3 (3 dika) ‚Ä¢ Kara-fisitra ‚Ä¢ Kara-panjakana
‚Ä¢ Faktiora JIRAMA (raha tompon-trano)
‚Ä¢ Kopy livret de famille na CIN (raha anaran‚Äôny ray aman-dreny maty ny faktiora ‚Üí porofo maha-olona akaiky)

‚Äî Fanavaozana Kara-Fisitra :
‚Ä¢ MAJ amin‚Äôny NIFONLINE ‚Ä¢ Rosia IS (3 dika) + vola miditra 3 taona farany
Fanamarihana : fiovana amin‚Äôny asa ‚Üí amin‚Äôny NIFONLINE.

‚Äî Taratasy fanamarinana :
(Fiara tsy mandoa hetra) : Fangatahana, kara-grisa (orig+kop.), attestation farany, bulletin de paie/avis de cr√©dit/kara-fisitra, fanamarinam-ponenana, kopy CIN.
(Resident fiscal) : Fangatahana + fanambarana amin‚Äôny voninahitra (vola miditra eto an-toerana/any ivelany), kara-mponina, kara-panondro matihanina (raha asa), fiche de paie, taratasy & rosia fandoavam-bola (manokana/orinasa), lisitry ny mpandray tombontsoa.
(Fandoavana IRSA) : Fangatahana x2, kopia fanambarana IRSA + rosia + tatitra, kara-fisitra mpampiasa, fanamarinam-ponenan‚Äôny mpiasa, kopia CIN, procuration raha solontena, laharana finday.
(Tsy mandoa hetra amin‚Äôny fidiram-bola/synth√©tique) : Fangatahana x2, kopia attestation farany, fanamarinam-ponenana, taratasy mpiantoka nosoniavin‚Äôny Fokontany, karatra fisotroan-dronono (raha misotro ronono), attestation tsy an‚Äôasa (raha tsy miasa), kopia CIN.

‚Äî Fampitsaharana asa (PM) :
Tatitry ny famaranana ara-bola nosoniavin‚Äôny tompon‚Äôandraikitra, Statuts, taratasy fangatahana (3 dika), PV famaranana voasoratra, kopia IS/IR farany + rosia, taratasy fananan-trano (titre/r√¥le IFPB), bail farany (na fanafoanana), famerenana kara-fisitra, fanambarana rehetra (IRSA, IS, IR, TVA, licence) ho ara-dal√†na.

‚Äî Fahazoan-dalana/Licence (oh: toaka) :
Fiche de renseignement nosoniavin‚Äôny sefom-pokontany, CIN (orig+kop.), casier judiciaire <3 vol., fanamarinam-ponenana, sarin-toerana nosoniavin‚Äôny Fokontany, plan ny toerana, rosia FIPB na titre, statuts + fanendrena tale (raha orinasa), d√©rogation manokana raha ilaina.

Fitsipika :
1) Valio amin‚Äôilay fiteny izay ampiasain'ilay olona amin‚Äôny mpampiasa (FR na MG). Raha tsy mazava, araho ny fiteny voafidy ao amin‚Äôny tranonkala.
2) Raha misy fangatahana hifindra pejy (Accueil, Services, Contact), ampio eo AMBANY TSIPIKA iray : page= Accueil|Services|Contact (na page= None).
3) Aoka ho fohy sy mazava.`;

    // UI helpers
const chatOpen = document.getElementById('chatOpen');
const chatClose = document.getElementById('chatClose');
const chatPanel = document.getElementById('chatPanel');
const chatMessages = document.getElementById('chatMessages');
const chatInput = document.getElementById('chatInput');
const chatSend = document.getElementById('chatSend');

/* --- Helpers UI --- */
function showChat(){
  chatPanel.classList.remove('hidden');
  if(chatMessages.children.length === 0){
    const l = document.documentElement.getAttribute('data-lang') || 'mg';
    addBotMsg(l==='fr'
      ? "Bonjour ! Je peux r√©pondre sur les d√©marches CF3 (NIF, IS, attestations, etc.). Posez votre question."
      : "Salama ! Afaka manampy momba ny serivisy CF3 (NIF, IS, taratasy fanamarinana, sns.). Manontania azafady.");
  }
  chatInput?.focus();
}
function hideChat(){ chatPanel.classList.add('hidden'); }

chatOpen?.addEventListener('click', showChat);
chatClose?.addEventListener('click', hideChat);

function addUserMsg(text){
  const d = document.createElement('div');
  d.className = 'msg user';
  d.textContent = text;
  chatMessages.appendChild(d);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}
function addBotMsg(text){
  const d = document.createElement('div');
  d.className = 'msg bot';
  d.textContent = text;
  chatMessages.appendChild(d);
  chatMessages.scrollTop = chatMessages.scrollHeight;
  maybeNavigate(text);
}
function addTyping(){
  const d = document.createElement('div');
  d.className = 'msg bot';
  d.id = 'typing';
  d.textContent = '‚Ä¶';
  chatMessages.appendChild(d);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}
function removeTyping(){
  document.getElementById('typing')?.remove();
}

/* --- Langue & contexte --- */
const history = [];
function getKB(){
  const l = document.documentElement.getAttribute('data-lang') || 'mg';
  return l === 'fr' ? KB_FR : KB_MG;
}
function currentLang(){ return document.documentElement.getAttribute('data-lang') || 'mg'; }

/* --- Appel Groq (avec fallback mod√®le) --- */
async function groqCompletion(messages, model){
  const payload = { model, temperature: 0.2, messages };
  const res = await fetch(GROQ_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${GROQ_API_KEY}` },
    body: JSON.stringify(payload)
  });

  const text = await res.text();
  let data;
  try { data = JSON.parse(text); } catch { /* pas JSON ‚Üí gardera text brut */ }

  if(!res.ok){
    // Si le mod√®le est d√©commissionn√©, on remonte un signal sp√©cial
    const code = data?.error?.code || data?.error?.type || '';
    const err = new Error(`Erreur API Groq: ${res.status} ${text}`);
    if(String(code).includes('model_decommissioned')) err.decommissioned = true;
    throw err;
  }
  return (data?.choices?.[0]?.message?.content || '').trim();
}

async function askGroq(question){
  const sys = getKB();
  const lang = currentLang();
  const messages = [
    { role: "system", content: sys },
    { role: "system", content: `Langue s√©lectionn√©e sur le site : ${lang.toUpperCase()}.` },
    ...history,
    { role: "user", content: question }
  ];

  // Essaye le mod√®le principal puis les fallbacks si besoin
  const modelsToTry = [MODEL_PRIMARY, ...MODEL_FALLBACKS];
  let lastErr;
  for(const m of modelsToTry){
    try{
      return await groqCompletion(messages, m);
    }catch(e){
      lastErr = e;
      if(e.decommissioned) { continue; } // on tente le suivant
      else { throw e; }
    }
  }
  throw lastErr || new Error("Aucun mod√®le disponible.");
}

/* --- Navigation automatique selon 'page= ...' --- */
function maybeNavigate(text){
  const m = text.match(/page\s*=\s*(accueil|services|contact|none)/i);
  if(!m) return;
  const page = m[1].toLowerCase();
  if(page === 'accueil'){ window.scrollTo({top:0,behavior:'smooth'}); }
  if(page === 'services'){ document.getElementById('services')?.scrollIntoView({behavior:'smooth'}); }
  if(page === 'contact'){ document.getElementById('contact')?.scrollIntoView({behavior:'smooth'}); }
}

/* --- Envoi UI --- */
async function sendMsg(){
  const q = (chatInput.value || '').trim();
  if(!q) return;
  addUserMsg(q);
  chatInput.value = '';
  addTyping();
  try{
    const ans = await askGroq(q);
    removeTyping();
    addBotMsg(ans);
    history.push({role:'user', content:q});
    history.push({role:'assistant', content:ans});
    if(history.length > 10) history.splice(0, history.length - 10);
  }catch(e){
    removeTyping();
    addBotMsg((currentLang()==='fr')
      ? "D√©sol√©, une erreur est survenue. R√©essayez plus tard."
      : "Miala tsiny, nisy olana. Andramo indray azafady.");
    console.error(e);
  }
}
chatSend?.addEventListener('click', sendMsg);
chatInput?.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); sendMsg(); } });
  </script>
</body>
</html>
